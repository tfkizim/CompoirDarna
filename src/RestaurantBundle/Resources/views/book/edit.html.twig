{% extends '::base.html.twig' %}
{% block body %}
    {% block barre %}{{ parent() }}{% endblock %}
    {% block menu %}{{ parent() }}{% endblock %}
    <div id="i-am-user-edit-page"></div>
    <div id="page_content">
        <div id="page_content_inner">
            <div class="uk-grid" data-uk-grid-margin>
                <div class="uk-width-large-1-1">
                    <div class="md-card">
                        <div class="uk-breadcrumb-wrapper">
                            <ul class="uk-breadcrumb">
                                <li><a href="{{ path('restaurant_restaurant') }}"><i class="material-icons">home</i></a></li>
                                <li><a href="{{ path('restaurant_calendar') }}">Calendrier de réservations</a></li>
                                <li><a href="{{ path('book_detail',{id:book.id}) }}">Détails réservation</a></li>
                                <li><a href="#">Modifier réservation</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <form action="{{ path('book_save',{id:book.id}) }}" class="uk-form-stacked" method="post" id="book_edit_form">
                <div class="uk-grid" data-uk-grid-margin>
                    <div class="uk-width-large-1-1">
                        <div class="md-card">
                            <div class="user_heading" data-uk-sticky="{ top: 48, media: 960 }">
                                {% if book.companyId %}
                                <div class="user_heading_avatar fileinput fileinput-new" data-provides="fileinput">
                                    <div class="fileinput-new thumbnail">
                                        <div class="item-avatar-wrapper">
                                            <span class="item-avatar uk-text-contrast md-bg-{{book.companyId.typeCompanyId.color}}">{{book.companyId.typeCompanyId.abbr}}</span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                {% if book.customerId %}
                                    <div class="user_heading_content">
                                        <h2 class="heading_b"><span class="uk-text-truncate" id="user_edit_uname">{{ book.customerId.firstName~' '~book.customerId.lastName }}</span></h2>
                                    </div>
                                {% endif %}
                                <div class="md-fab-wrapper">
                                    <button type="submit" id="user_edit_save" data-uk-tooltip="{cls:'uk-tooltip-small',pos:'bottom'}" class="md-fab md-fab-small md-fab-success" title="Save"><i class="material-icons md-color-white">&#xE161;</i></button>
                                </div>
                            </div>
                            <div class="user_content">
                                <ul id="user_edit_tabs" class="uk-tab" data-uk-tab="{connect:'#user_edit_tabs_content'}">
                                    <li class="uk-active"><a href="#">Réservation</a></li>
                                </ul>
                                <ul id="user_edit_tabs_content" class="uk-switcher uk-margin">
                                    <li>
                                        <div class="uk-margin-top">
                                            <h3 class="full_width_in_card heading_c">
                                                Information générale
                                            </h3>
                                            <div class="uk-grid hidden-passage">
                                                <div class="uk-width-medium-2-3">
                                                    <div class="parsley-row">
                                                        <input type="hidden" id="book_id" name="book[id]" value="{{ book.id }}">
                                                        <label for="book_date" class="uk-required">Date<span class="req">*</span></label><br>
                                                        <input type="text" name="book[date]" id="book_date" data-parsley-trigger="blur change" required pattern="[0-9]{2}\-[0-9]{2}\-[0-9]{4}" value="{{ book.dateBook|date("d-m-Y") }}" />
                                                    </div>
                                                </div>
                                                <div class="uk-width-medium-1-3">
                                                    <div class="parsley-row">
                                                        <label for="book_hour" class="uk-required">Heure<span class="req">*</span></label><br>
                                                        <select name="book[hour]" id="book_hour" class="select-ym" required>
                                                            {% for service in services %}
                                                                {% set servicevaleur=service.valeur|json_decode() %}
                                                                {% set openhour=servicevaleur.Lundi.OPENHOUR %}
                                                                {% set closehour=servicevaleur.Lundi.CLOSEHOUR %}
                                                                {% set interval=servicevaleur.Lundi.INTERVAL %}
                                                                {% set openhourtimestamp=(("1970-01-01 "~openhour)|date("U")) %}
                                                                {% set closehourtimestamp=(("1970-01-01 "~closehour)|date("U")) %}
                                                                {% for hour in range(low=openhourtimestamp, high=closehourtimestamp, step=interval) %}
                                                                    <option value="{{ service.id }}|{{ hour|date("H\:i") }}" {% if (hour|date("H\:i"))==(book.dateBook|date("H\:i")) %}selected{% endif %}>{{ hour|date("H\:i") }}</option>
                                                                {% endfor %}
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="uk-grid">
                                                <div class="uk-width-medium-2-2">
                                                    <div class="parsley-row">
                                                        <label for="book_pax" class="uk-required">Pax<span class="req">*</span></label><br>
                                                        <button data-val="1" class="btn btn-primary btn-ym btn-pax {% if book.pax==1 %}active{% endif %}" type="button">1</button>
                                                        <button data-val="2" class="btn btn-primary btn-ym btn-pax {% if book.pax==2 %}active{% endif %}" type="button">2</button>
                                                        <button data-val="3" class="btn btn-primary btn-ym btn-pax {% if book.pax==3 %}active{% endif %}" type="button">3</button>
                                                        <button data-val="4" class="btn btn-primary btn-ym btn-pax {% if book.pax==4 %}active{% endif %}" type="button">4</button>
                                                        <input type="number" data-parsley-type="integer" name="book[pax]" data-parsley-trigger="change blur keyup" id="book_pax" value="{{ book.pax }}" min="1" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="uk-grid">
                                                <div class="uk-width-medium-1-3">
                                                    <div class="parsley-row">
                                                        <label for="book_floor" class="uk-required">Etage</label>
                                                        <select id="book_floor" name="book[floor]" data-md-selectize>
                                                            <option value="">Select...</option>
                                                            {% for floor in floors %}
                                                                <option value="{{ floor.id }}" {% if book.floorId %}{% if book.floorId.id == floor.id %}selected{% endif %}{% endif %}>{{ floor.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="uk-width-medium-2-3">
                                                    <div class="parsley-row">
                                                        {% set alltables="" %}
                                                        {% if book.booktabls %}
                                                            {% for bookedtabls in book.booktabls %}
                                                                {% if alltables is empty %}
                                                                    {% set alltables=bookedtabls.tablId.name %}
                                                                {% else %}
                                                                    {% set alltables=alltables~"+"~bookedtabls.tablId.name %}
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endif %}
                                                        <label for="" class="uk-required">Sélectionner tables</label><br>
                                                        <div class="uk-input-group">
                                                            <span class="uk-input-group-addon">
                                                                <a href="#" class="md-btn md-btn-small md-btn-success select-modal-plan" data-id="2"><i class="material-icons uk-text-contrast">add</i></a>
                                                            </span>
                                                            <div class="md-input-wrapper"><input type="text" class="k-textbox input-selected-tables" name="book[tables_name]" data-parsley-trigger="keyup" pattern="(([\ ]+)?)((\d+)(([\ ]+)?)((\+)?)(([\ ]+)?))+" data-id="2" value="{{ alltables }}"><input type="hidden" class="selected-tables-id" name="book[tables_id]" data-id="2" value=""><span class="md-input-bar"></span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="uk-grid hidden-passage">
                                                <div class="uk-width-medium-1-2">
                                                    <div class="parsley-row">
                                                        <label for="company_json" class="uk-form-label">Établissement</label>
                                                        <input class="uk-width-1-1" id="company_json" name="book[company]" type="text" value="{% if book.companyId %}{{ book.companyId.id }}{% endif %}" />
                                                    </div>
                                                </div>
                                                <div class="uk-width-medium-1-2">
                                                    <div class="parsley-row">
                                                        <label for="book_state" class="uk-form-label">Statut</label>
                                                        <select id="book_state" name="book[state]" data-md-selectize>
                                                            <option value="">Choisir..</option>
                                                            {% set i=0 %}
                                                            {% for state in states %}
                                                                <option value="{{ state.id }}" {% if book.stateId %}{% if book.stateId.id==state.id %}selected{% endif %}{% endif %}>{{ state.name }}</option>
                                                                {% set i=i+1 %}
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="uk-grid hidden-passage">
                                                <div class="uk-width-medium-1-2">
                                                    <div class="parsley-row">
                                                        <label for="book_offer" class="uk-form-label">Offert</label>
                                                        <select id="book_offer" name="book[offer]" data-md-selectize>
                                                            <option value="">Choisir..</option>
                                                            {% for offer in offers %}
                                                                <option value="{{ offer.id }}" {% if book.offerId %}{% if book.offerId.id==offer.id %}selected{% endif %}{% endif %}>{{ offer.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="uk-width-medium-1-2">
                                                    <div class="parsley-row">
                                                        <label for="book_occasion" class="uk-form-label">Occasion</label>
                                                        <select id="book_occasion" name="book[occasion]" data-md-selectize>
                                                            <option value="">Choisir..</option>
                                                            {% for occasion in occasions %}
                                                                <option value="{{ occasion.id }}" {% if book.occasionId %}{% if book.occasionId.id==occasion.id %}selected{% endif %}{% endif %}>{{ occasion.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="uk-grid">
                                                <div class="uk-width-1-1">
                                                    <div class="parsley-row">
                                                        <label for="message">Note Admin</label>
                                                        <textarea id="book_noteadmin" class="k-textbox" name="book[noteadmin]" cols="10" rows="4">{{ book.noteAdmin }}</textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="uk-grid">
                                                <div class="uk-width-1-1">
                                                    <div class="parsley-row">
                                                        <label for="book_notecustomer">Note Client</label>
                                                        <textarea id="book_notecustomer" class="k-textbox" name="book[notecustomer]" cols="10" rows="4">{{ book.noteCustomer }}</textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

            </form>

        </div>
    </div>
{% endblock %}